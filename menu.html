<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Smart Economato</title>
    <link rel="icon" type="image/png" href="assets/img/logo.png?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/dashboard.css">
    <link rel="stylesheet" href="assets/css/ingreso.css">
    <link rel="stylesheet" href="assets/css/accessibility.css">
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
</head>

<body>

    <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <script type="module" src="src/views/main.js"></script>

    <!-- Overlay para cerrar menú en móvil -->
    <div class="menu-overlay" id="menuOverlay"></div>

    <aside class="menu" id="sidebar">
        <div class="menu-header">
            <img src="assets/img/LOGO CIFP VIRGEN DE CANDELARIA.png" alt="Logo de cifp virgen de candelaria"
                class="logo-menu">
        </div>

        <nav>
            <a href="#" data-page="Inicio" class="activo">
                <i class="fa-solid fa-house"></i> Inicio
            </a>
            <a href="#" data-page="Avisos">
                <i class="fa-solid fa-bell"></i> Avisos
            </a>
            <a href="#" data-page="Recepcion">
                <i class="fa-solid fa-truck-ramp-box"></i> Recepción
            </a>
            <a href="#" data-page="Distribucion">
                <i class="fa-solid fa-dolly"></i> Distribución
            </a>
            <a href="#" data-page="Inventario">
                <i class="fa-solid fa-boxes-stacked"></i> Inventario
            </a>
            <a href="#" data-page="Bajas">
                <i class="fa-solid fa-circle-exclamation"></i> Bajas
            </a>
            <a href="#" data-page="Proveedores">
                <i class="fa-solid fa-address-book"></i> Proveedores
            </a>
            <a href="#" data-page="Pedidos">
                <i class="fa-solid fa-file-invoice-dollar"></i> Pedidos
            </a>
            <a href="#" data-page="Escandallos">
                <i class="fa-solid fa-utensils"></i> Escandallos
            </a>
            <a href="#" data-page="Informes">
                <i class="fa-solid fa-chart-pie"></i> Informes
            </a>

            <!-- Sección Administrativa -->
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                <a href="#" data-page="Configuracion">
                    <i class="fa-solid fa-gear"></i> Configuración
                </a>
                <a href="#" data-page="Auditoria" style="opacity: 0.9;">
                    <i class="fa-solid fa-clipboard-list"></i> Auditoría
                </a>
            </div>

            <a href="index.html" class="logout-btn">
                <i class="fa-solid fa-right-from-bracket"></i> Salir
            </a>
        </nav>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <!-- Botón hamburguesa (solo visible en móvil) -->
            <button class="menu-toggle" id="menuToggle" aria-label="Abrir menú">
                <i class="fa-solid fa-bars"></i>
            </button>

            <h1 id="page-title">Panel de Control</h1>

            <div class="user-info-wrapper">
                <div class="user-info" id="profileToggle" role="button" tabindex="0" aria-haspopup="true">
                    <span>Hola, Administrador</span>
                    <div class="user-avatar">A</div>
                    <i class="fa-solid fa-chevron-down profile-chevron"></i>
                </div>

                <!-- Profile Dropdown -->
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="dropdown-header">
                        <div class="dropdown-avatar">A</div>
                        <div class="dropdown-user-info">
                            <span class="dropdown-name">Administrador</span>
                            <span class="dropdown-role">Gestor de Economato</span>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>

                    <div class="dropdown-section">
                        <a href="#" data-page="Avisos" class="dropdown-item">
                            <i class="fa-solid fa-bell"></i>
                            <span>Centro de Avisos</span>
                            <span class="dropdown-badge" id="dropdown-alertas"></span>
                        </a>
                        <a href="#" data-page="Configuracion" class="dropdown-item">
                            <i class="fa-solid fa-gear"></i>
                            <span>Configuracion</span>
                        </a>
                    </div>

                    <div class="dropdown-divider"></div>

                    <div class="dropdown-section">
                        <div class="dropdown-item dropdown-info">
                            <i class="fa-solid fa-clock"></i>
                            <span>Sesion iniciada</span>
                            <span class="dropdown-meta" id="dropdown-session"></span>
                        </div>
                        <div class="dropdown-item dropdown-info">
                            <i class="fa-solid fa-calendar-day"></i>
                            <span>Fecha</span>
                            <span class="dropdown-meta" id="dropdown-fecha"></span>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>

                    <a href="index.html" class="dropdown-item dropdown-logout">
                        <i class="fa-solid fa-right-from-bracket"></i>
                        <span>Cerrar Sesion</span>
                    </a>
                </div>
            </div>
        </header>

        <div id="content" aria-live="polite" aria-atomic="true">
        </div>
    </main>

    <script type="module" src="src/views/main.js?v=3"></script>
    <script src="src/utils/script.js?v=3"></script>

    <!-- Script para toggle del menú móvil -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('menuOverlay');

            // Abrir menú
            menuToggle?.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            });

            // Cerrar menú al hacer clic en el overlay
            overlay?.addEventListener('click', () => {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            });

            // Cerrar menú al seleccionar una opción
            const menuLinks = sidebar.querySelectorAll('a[data-page]');
            menuLinks.forEach(link => {
                link.addEventListener('click', () => {
                    setTimeout(() => {
                        sidebar.classList.remove('open');
                        overlay.classList.remove('active');
                    }, 100);
                });
            });

            // --- Profile Dropdown ---
            const profileToggle = document.getElementById('profileToggle');
            const profileDropdown = document.getElementById('profileDropdown');
            const sessionStart = new Date();

            // Populate session info
            const fechaEl = document.getElementById('dropdown-fecha');
            if (fechaEl) {
                fechaEl.textContent = new Date().toLocaleDateString('es-ES', {
                    weekday: 'long', day: 'numeric', month: 'long'
                });
            }

            function updateSessionTime() {
                const el = document.getElementById('dropdown-session');
                if (!el) return;
                const mins = Math.floor((Date.now() - sessionStart) / 60000);
                if (mins < 1) el.textContent = 'Ahora';
                else if (mins < 60) el.textContent = mins + ' min';
                else el.textContent = Math.floor(mins / 60) + 'h ' + (mins % 60) + 'm';
            }
            updateSessionTime();
            setInterval(updateSessionTime, 60000);

            // Toggle dropdown
            profileToggle?.addEventListener('click', (e) => {
                e.stopPropagation();
                profileDropdown.classList.toggle('open');
                profileToggle.classList.toggle('active');
            });

            // Close on outside click
            document.addEventListener('click', (e) => {
                if (!profileDropdown?.contains(e.target) && !profileToggle?.contains(e.target)) {
                    profileDropdown?.classList.remove('open');
                    profileToggle?.classList.remove('active');
                }
            });

            // Close on Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    profileDropdown?.classList.remove('open');
                    profileToggle?.classList.remove('active');
                }
            });

            // Close dropdown when clicking a link inside it
            profileDropdown?.querySelectorAll('a[data-page]').forEach(link => {
                link.addEventListener('click', () => {
                    profileDropdown.classList.remove('open');
                    profileToggle.classList.remove('active');
                });
            });
        });
    </script>
</body>

</html>